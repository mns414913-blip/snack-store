<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Snacks Store</title>

<style>
body {font-family: Arial; margin:0; background:#f2f2f2; padding-bottom:100px;}
header {background:#ff9800; padding:15px; color:white; display:flex; justify-content:space-between;}
#cartBox {background:white; padding:10px; border-radius:8px; width:250px;}
.products {display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:10px; padding:10px;}
.product {background:white; padding:10px; border-radius:8px; text-align:center;}
button {padding:5px 10px; margin:3px;}
.top-ad, .bottom-ad {width:100%; text-align:center; background:#ddd; padding:5px 0;}
.bottom-ad {position:fixed; bottom:0; left:0;}
</style>
</head>
<body>

<div class="top-ad">
  <img src="https://via.placeholder.com/900x80?text=Ø§Ø¹Ù„Ø§Ù†+Ù‡Ù†Ø§" />
</div>

<header>
<h2>Snacks Store</h2>
<div id="cartBox">
<h4>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h4>
<div id="cartItems"></div>
<b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span> Ø¬</b>
</div>
</header>

<div class="products" id="products"></div>

<h3 style="padding:10px">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
<div style="padding:10px">
<input id="custName" placeholder="Ø§Ø³Ù…Ùƒ" required><br><br>
<input id="custPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required><br><br>
<input id="shopName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"><br><br>
<button onclick="getLocation()">ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
<div id="locationText"></div><br>
<button onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<div class="bottom-ad">
  <img src="https://via.placeholder.com/900x80?text=Ø§Ø¹Ù„Ø§Ù†+Ù‡Ù†Ø§" />
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBY0MBybVBW5GHpN1gatyrOqdYHkH726zw",
  authDomain: "snacks-store-35112.firebaseapp.com",
  databaseURL: "https://snacks-store-35112-default-rtdb.firebaseio.com",
  projectId: "snacks-store-35112",
  storageBucket: "snacks-store-35112.firebasestorage.app",
  messagingSenderId: "523521529745",
  appId: "1:523521529745:web:2fb1ec4fc48d99e11eec30"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let cart = [];
let userLocation = "";

function updateCart() {
  const cartDiv = document.getElementById("cartItems");
  cartDiv.innerHTML = "";
  let total = 0;
  cart.forEach(p => {
    total += p.price * p.qty;
    cartDiv.innerHTML += `<div>${p.name} Ã— ${p.qty}</div>`;
  });
  totalEl.innerText = total;
}

window.addQty = (id, name, price) => {
  let item = cart.find(i => i.id === id);
  if(item) item.qty++;
  else cart.push({id,name,price,qty:1});
  updateCart();
};

window.minusQty = (id) => {
  let item = cart.find(i => i.id === id);
  if(item && item.qty>1) item.qty--;
  updateCart();
};

onValue(ref(db,"products"), snap => {
  products.innerHTML="";
  snap.forEach(child=>{
    let p=child.val();
    products.innerHTML += `
      <div class="product">
        <img src="${p.img}" width="80"><br>
        ${p.name}<br>
        ${p.price} Ø¬<br>
        <button onclick="addQty('${child.key}','${p.name}',${p.price})">â•</button>
        <button onclick="minusQty('${child.key}')">â–</button>
      </div>`;
  });
});

window.getLocation = ()=>{
 navigator.geolocation.getCurrentPosition(pos=>{
   userLocation = \`https://maps.google.com/?q=\${pos.coords.latitude},\${pos.coords.longitude}\`;
   locationText.innerText="ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ âœ”";
 });
};

window.sendOrder = ()=>{
 let name = custName.value;
 let phone = custPhone.value;

 if(!name) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
 if(!phone) return alert("Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");

 push(ref(db,"orders"),{
   name,
   phone,
   shop:shopName.value,
   location:userLocation,
   cart,
   status:"Ø¬Ø¯ÙŠØ¯"
 });

 alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨");
 cart=[]; updateCart();
};
</script>
</body>
</html>
