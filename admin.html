<!DOCTYPE html>
<html lang="ar">
<head><meta charset="UTF-8"/><title>Admin</title></head>
<body>

<h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>

<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
<input id="pname" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input id="pprice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<input id="pimg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©">
<button onclick="addProduct()">Ø¥Ø¶Ø§ÙØ©</button>

<h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
<div id="orders"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = { apiKey:"AIzaSyBY0MBybVBW5GHpN1gatyrOqdYHkH726zw", authDomain:"snacks-store-35112.firebaseapp.com",
databaseURL:"https://snacks-store-35112-default-rtdb.firebaseio.com", projectId:"snacks-store-35112",
storageBucket:"snacks-store-35112.firebasestorage.app", messagingSenderId:"523521529745",
appId:"1:523521529745:web:2fb1ec4fc48d99e11eec30"};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.addProduct = ()=> push(ref(db,"products"),{name:pname.value,price:pprice.value,img:pimg.value});

onValue(ref(db,"orders"), snap=>{
 orders.innerHTML="";
 snap.forEach(c=>{
   let o=c.val(); let total=0;
   let itemsHTML="";
   o.cart.forEach((item,i)=>{
     total+=item.price*item.qty;
     itemsHTML+=`
     <div>
       <img src="${item.img}" width="40">
       ${item.name} Ã— ${item.qty}
       <button onclick="removeItem('${c.key}',${i})">âŒ</button>
     </div>`;
   });

   orders.innerHTML+=`
   <div style="border:1px solid #000;margin:10px;padding:10px">
   ğŸ‘¤ ${o.name} â€” ğŸ“ ${o.phone}<br>
   <a href="${o.location}" target="_blank">Ø§Ù„Ù…ÙˆÙ‚Ø¹</a><br>
   ${itemsHTML}
   <b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬</b><br>
   Ø§Ù„Ø­Ø§Ù„Ø©: ${o.status}<br>
   <button onclick="confirmOrder('${c.key}')">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
   </div>`;
 });
});

window.confirmOrder=id=> update(ref(db,"orders/"+id),{status:"ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯"});

window.removeItem=(orderId,index)=>{
 const orderRef=ref(db,"orders/"+orderId+"/cart/"+index);
 update(orderRef,{qty:0});
};
</script>
</body>
</html>
