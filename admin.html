<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8"/>
<title>Admin - Snacks Store</title>
<style>
body {font-family:Arial; background:#f2f2f2; text-align:center;}
#panel {display:none;}
input, button {padding:8px;margin:5px;}
.orderBox{border:1px solid #000;margin:10px;padding:10px;background:#fff; text-align:right;}
img.productImg{width:50px; height:50px; object-fit:cover; margin-right:5px;}
</style>
</head>
<body>

<h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Snacks Store</h2>

<!-- Ø´Ø§Ø´Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± -->
<div id="loginBox">
  <h3>Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h3>
  <input type="password" id="passInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
  <button onclick="checkPass()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
<div id="panel">

<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
<input id="pname" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input id="pprice" placeholder="Ø§Ù„Ø³Ø¹Ø±" type="number"><br>
<label>Ø±ÙØ¹ ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²:</label>
<input type="file" id="pimgFile" accept="image/*"><br>
<label>Ø£Ùˆ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©:</label>
<input id="pimgURL" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
<button onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>

<h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
<div id="orders"></div>

</div>

<script>
const correctPass = "01012768312pqpqwuyieqw";
function checkPass(){
  if(passInput.value === correctPass){
    loginBox.style.display="none";
    panel.style.display="block";
  } else alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø· âŒ");
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-storage.js";

const firebaseConfig = {
  apiKey:"AIzaSyBY0MBybVBW5GHpN1gatyrOqdYHkH726zw",
  authDomain:"snacks-store-35112.firebaseapp.com",
  databaseURL:"https://snacks-store-35112-default-rtdb.firebaseio.com",
  projectId:"snacks-store-35112",
  storageBucket:"snacks-store-35112.firebasestorage.app",
  messagingSenderId:"523521529745",
  appId:"1:523521529745:web:2fb1ec4fc48d99e11eec30"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ (Ø±ÙØ¹ ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ø£Ùˆ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±)
window.addProduct = async ()=>{
  const name = pname.value.trim();
  const price = Number(pprice.value);
  const file = document.getElementById("pimgFile").files[0];
  let url = document.getElementById("pimgURL").value.trim();

  if(!name || !price || (!file && !url)) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„Ù‡Ø§");

  if(file){ // Ø±ÙØ¹ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
    const storageRef = sRef(storage, 'products/' + Date.now() + '_' + file.name);
    await uploadBytes(storageRef, file);
    url = await getDownloadURL(storageRef);
  }

  push(ref(db,"products"),{name, price, img: url});
  alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!");
  pname.value=""; pprice.value=""; document.getElementById("pimgFile").value=""; document.getElementById("pimgURL").value="";
};

// Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø§Ù„ØµÙˆØ± ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
onValue(ref(db,"orders"), snap=>{
  orders.innerHTML="";
  snap.forEach(c=>{
    const o=c.val();
    let total=0;
    let itemsHTML="";
    o.cart.forEach((item,i)=>{
      if(item.qty>0){
        total+=item.price*item.qty;
        itemsHTML+=`
          <div>
            <img src="${item.img}" class="productImg">
            ${item.name} Ã— ${item.qty} = ${item.price*item.qty} Ø¬
            <button onclick="removeItem('${c.key}',${i})">âŒ Ø±ÙØ¶</button>
          </div>`;
      }
    });

    orders.innerHTML+=`
      <div class="orderBox">
        ğŸ‘¤ ${o.name} â€” ğŸ“ ${o.phone}<br>
        ğŸ¬ ${o.shop || "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}<br>
        <a href="${o.location}" target="_blank">Ø§Ù„Ù…ÙˆÙ‚Ø¹</a><br>
        ${itemsHTML}
        <b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬</b><br>
        Ø§Ù„Ø­Ø§Ù„Ø©: ${o.status}<br>
        <button onclick="confirmOrder('${c.key}')">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
      </div>`;
  });
});

// ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
window.confirmOrder=id=> update(ref(db,"orders/"+id),{status:"ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯"});

// Ø­Ø°Ù Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø·Ù„Ø¨ (Ø±ÙØ¶)
window.removeItem=(orderId,index)=>{
  const itemRef = ref(db,"orders/"+orderId+"/cart/"+index);
  update(itemRef,{qty:0});
};
</script>

</body>
</html>
